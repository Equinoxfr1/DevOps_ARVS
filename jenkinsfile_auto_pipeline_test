pipeline {
    agent any
    
    stages {
        stage('Get Issues') {
            steps {
                script {
                    // Récupérer les issues via l'API GitHub
                    def response = sh(script: 'curl -s https://api.github.com/repos/Equinoxfr1/DevOps_ARVS/issues', returnStdout: true)
                    
                    // Utiliser jq pour extraire les titres des issues
                    def issues = sh(script: "echo '${response}' | jq -r '.[] | .title'", returnStdout: true).split('\n')
                    
                    // Créer un stage pour chaque issue
                    issues.each { issue ->
                        stage("Issue: ${issue}") {
                            steps {
                                echo "Handling issue: ${issue}"
                                // Ajouter ici ce que tu veux faire pour chaque issue, par exemple une tâche de test ou d'intégration
                            }
                        }
                    }
                }
            }
        }
    }
}
